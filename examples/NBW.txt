#
# Should be non-robust.
#
# The Non-Blocking Write Protocol NBW: A Solution to a Real-Time
# Synchronisation Problem. H. Kopetz and J. Reisinger IEEE Real-Time
# Systems Symposium 1993

# Memory layout:
#
# 0 — buf[i]
# 1 — CCG[i]

thread writer1
initial q0
transition	q0	q0_1	local	buf	0
transition	q0_1	q1	local	counter	1
transition	q1	q2	read	cnt	counter
transition	q2	q3	write	+ cnt 1	counter
transition	q3	q4	write	666	buf
transition	q4	q5	write	+ cnt 2	counter
end

thread reader1
initial q0
transition	q0	q0_1	local	buf	0
transition	q0_1	q1	local	counter	1
transition	q1	q2	read	cnt_b	counter
transition	q2	q3	read	value	buf
transition	q4	q5	read	cnt_e	counter
transition	q5	q0	check	|| != cnt_b cnt_e  == & cnt_b 1 1
transition	q5	q6	check	&& == cnt_b cnt_e  == & cnt_b 1 0
end

thread writer2
initial q0
transition	q0	q0_1	local	buf	0
transition	q0_1	q1	local	counter	1
transition	q1	q2	read	cnt	counter
transition	q2	q3	write	+ cnt 1	counter
transition	q3	q4	write	666	buf
transition	q4	q5	write	+ cnt 2	counter
end

thread reader2
initial q0
transition	q0	q0_1	local	buf	0
transition	q0_1	q1	local	counter	1
transition	q1	q2	read	cnt_b	counter
transition	q2	q3	read	value	buf
transition	q4	q5	read	cnt_e	counter
transition	q5	q0	check	|| != cnt_b cnt_e  == & cnt_b 1 1
transition	q5	q6	check	&& == cnt_b cnt_e  == & cnt_b 1 0
end
